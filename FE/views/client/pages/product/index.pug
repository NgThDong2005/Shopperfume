extends ../../layouts/default.pug

block main
  .product-detail
    .product-gallery
      if product.images && product.images.length > 0
        img.main-image(src=product.image alt=product.name)
        .thumbnail-list
          each img, i in product.images
            img.thumbnail(src=img alt=`${product.name} ${i}`)

    .product-info
      if product.brand
        .brand
          h1.brand-name= `${product.brand.name}`

      h1.product-name-detail= product.name
      p.product-price-detail= `${Number(product.price).toLocaleString()} VND`

      .product-description
        != product.description

      button.add-to-cart(
        type="button"
        data-product-id=product.id
      ) Thêm vào danh sách yêu thích
      a.buy-now(href=`/cart/add/${product.slug}?action=buy`) Mua ngay

block scripts
  script.
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.querySelector(".add-to-cart");

      if (btn) {
        btn.addEventListener("click", async () => {
          const productId = btn.getAttribute("data-product-id");

          try {
            const res = await fetch("/wishlist/add", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({ product_id: productId })
            });

            const data = await res.json();
            if (res.ok) {
              alert("Đã thêm vào danh sách yêu thích!");
            } else {
              alert(data.message);
            }
          } catch (err) {
            console.error(err);
            alert("Có lỗi xảy ra!");
          }
        });
      }
    });
